<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head('Posts Feed')">
</head>
<body>
<header th:replace="fragments/navbar :: navbar"></header>

<div class="main-bg" th:switch="${hasProfile}">
    <div class="container" th:case="${true}">
        <div class="row">
            <div class="col-md-3" id="mob">
                <!--                <div class="card">-->
                <!--                    <ul class="list-group list-group-flush">-->
                <!--                        <li class="list-group-item"><a href="#">Notifications</a></li>-->
                <!--                        <li class="list-group-item"><a href="#">Messages</a></li>-->
                <!--                        <li class="list-group-item"><a href="/feed/posts">Posts</a></li>-->
                <!--                        <li class="list-group-item"><a href="/feed/events">Events</a></li>-->
                <!--                        <li class="list-group-item"><a th:href="'/my-profile/' + ${profileId}">My Profile</a></li>-->
                <!--                    </ul>-->
                <!--                </div>-->
            </div>
            <div class="sidebar-container">

                <ul class="sidebar-navigation">
                    <li class="header"></li>
                    <li>
                        <a href="/feed/posts">
                            <i class="fa fa-home" aria-hidden="true"></i>Posts
                        </a>
                    </li>
                    <li>
                        <a href="/feed/events">
                            <i class="fa fa-tachometer" aria-hidden="true"></i>Events
                        </a>
                    </li>
                    <li>
                        <a th:href="'/my-profile/' + ${profileId}">
                            <i class="fa fa-users" aria-hidden="true"></i>My Profile
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa fa-cog" aria-hidden="true"></i> Notifcations
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa fa-info-circle" aria-hidden="true"></i> Messages
                        </a>
                    </li>
                </ul>
            </div>
            <div class="col-md-6 mt-3">
                <div class="card mb-3">
                    <div class="card-body">
                        <a th:href="'/posts/create'">Post a message, show your skills, or find a match for your gig.</a>
                    </div>
                </div>
                <div th:if="${noPostsFound}">
                    No posts were found.
                </div>
                <!--                <div class="card mb-2" th:each="post : ${posts}">-->
                <!--                    <div class="card-body">-->
                <!--                        <h5 th:text="${post.owner.username}"></h5>-->
                <!--                        <p class="card-text" th:text="${post.body}"></p>-->
                <!--                    </div>-->
                <!--                    <hr>-->

                <!--                                        <form th:href="'/posts/' + ${post.id} + '/comment'">-->
                <!--                                            <button type="submit" class="btn btn-primary mb-2">Add Comment</button>-->
                <!--                                        </form>-->
                <!--                    <a th:href="'/posts/' + ${post.id} + '/comment'">Add Comment</a>-->
                <!--                    <hr>-->
                <!--                    <a th:href="'/posts/' + ${post.id}">See Post</a>-->
                <!--                </div>-->


                <!--                    <form th:href="'/posts/' + ${post.id} + '/comment'">-->
                <!--                        <button type="submit" class="btn btn-primary mb-2">Add Comment</button>-->
                <!--                    </form>-->


                <!--POST REACTIONS TO VERIFY IF DATABASE IS CONNECTING TO THIS-->
                <!--                    <div>-->
                <!--                        <a th:text="${post.userReactions.size()}"></a>-->
                <!--                    </div>-->


                <!--                &lt;!&ndash; COMMENTS&ndash;&gt;-->
                <!--                    <a th:href="'/posts/' + ${post.id} + '/comment'">Add Comment</a>-->

                <!--                    <hr>-->
                <!--                    <a th:href="'/posts/' + ${post.id}">See Post</a>-->
                <!--                </div>-->

                <!--MASTER BELOW-->

                <!--                user posts-->

                <!--- \\\\\\\Post-->
                <div class="card gedf-card" th:each="post : ${posts}">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex justify-content-between align-items-center">


                                <div class="mr-2">
                                    <img class="rounded-circle" width="45"

                                         src="https://cdn.pixabay.com/photo/2017/06/13/12/53/profile-2398782_960_720.png"
                                         alt="">
                                </div>

                                <div class="ml-2">
                                    <div class="h5 m-0" th:text="${post.owner.username}"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body ">
                        <p class="card-text" th:text="${post.body}"></p>
                        <!--Image for Post-->
                        <!--Filestack-->
                        <div th:if="${post.img} == ''">
                            <!--                    <img  th:src="@{/img/logoGig.jpg}"-->
                            <!--                         class="card-img m-2" alt=" ">-->
                        </div>
                        <div th:unless="${post.img} == ''">
                            <img th:src="${post.img}"
                                 class="card-img" alt="image for post" style="max-height: 300px">
                        </div>
                    </div>

                    <!--POST REACTION TO CONNECT TO DATABASE&ndash;&gt;-->
                    <!--<div>-->
                    <!--<a th:text="${post.userReactions.size()}"></a>-->
                    <!--</div>-->
                    <!--<form th:method="Post" th:action="'/posts/'+ ${post.id} + '/reactions'" >-->
                    <!--<input type="submit" value="Like">-->
                    <!--</form>-->

                    <!--POST REACTION TO CONNECT TO DATABASE-->
                    <div class="card-footer d-flex justify-content-between">
                        <form th:method="Post" th:action="'/posts/'+ ${post.id} + '/reactions'">
                            <button type="submit" th:text="' Interested' + ' ' + ${ post.userReactions.size()}"
                                    class="fas fa-thumbs-up card-link btn" style="background-color: goldenrod" value=" Like "><i onclick="myFunction(this)">
                                Like</i>
                            </button>

                        </form>
                        <!--<a th:href="'/posts/' + ${post.id} + '/reactions'" class="card-link"><i class="fa fa-gittip"></i> Like</a>-->
                        <form th:method="GET" th:action="'/posts/' + ${post.id}" class="ml-5">
                        <button type="submit" style="background-color: goldenrod" value="View Post" class="btn">View Post
                        </button>
                        </form>
<!--                        <a th:href="'/posts/' + ${post.id}" class="ml-5">View Post</a>-->
                    </div>


                    <div class="row bootstrap snippets">
                        <div class="col-sm-12">
                            <div class="comment-wrapper">
                                <div class="panel panel-info">
                                    <div class="panel-heading mt-3">
                                        Comment panel
                                    </div>
                                    <div class="panel-body">
                                        <form th:action="${'/posts/' + post.id + '/comment'}" method="POST">
                                            <div class="form-group mx-sm-3 mb-2">
                                                <label for="content" class="sr-only">Comment</label>
                                                <input id="content" name="comment">
                                            </div>

                                            <br>
                                            <button type="submit" class="btn btn-info pull-right">Comment</button>
                                            <div class="clearfix"></div>
                                            <hr>
                                            <ul class="media-list">
                                                <li class="media">
                                                    <a href="#" class="pull-left">
                                                        <img src="" alt=""
                                                             class="img-circle">
                                                    </a>
                                                    <div class="media-body"><span class="text-muted pull-right"></span>
                                                        <strong class="text-success"></strong>
                                                        <p></p>
                                                    </div>
                                                </li>
                                            </ul>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-md-3 mt-3">
                <div class="card mb-3">
                    <img src="https://liveatnolan.com/wp-content/uploads/2018/06/Placeholder-Map.jpg"
                         class="card-img-top" alt="...">
                    <div class="card-body">
                        <p class="card-text">Map with center view of your city.</p>
                    </div>
                </div>
                <div class="card mb-3">
<!--                    <img src="https://promisedlandcsa.com/wp-content/uploads/2013/05/calendar_placeholder.gif"-->
<!--                         class="card-img-top" alt="...">-->
                    <div class="card-body">
<!--                        <p class="card-text">Your Calendar.</p>-->
                        <div class="calendar" id="calendar">
                            <div class="calendar-btn month-btn" onclick="$('#months').toggle('fast')">
                                <span id="curMonth"></span>
                                <div id="months" class="months dropdown"></div>
                            </div>

                            <div class="calendar-btn year-btn" onclick="$('#years').toggle('fast')">
                                <span id="curYear"></span>
                                <div id="years" class="years dropdown"></div>
                            </div>

                            <div class="clear"></div>

                            <div class="calendar-dates">
                                <div class="days">
                                    <div class="day label">S</div>
                                    <div class="day label">M</div>
                                    <div class="day label">T</div>
                                    <div class="day label">W</div>
                                    <div class="day label">T</div>
                                    <div class="day label">F</div>
                                    <div class="day label">S</div>

                                    <div class="clear"></div>
                                </div>

                                <div id="calendarDays" class="days">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="container" th:case="${false}">
                <div class="row">
                    <div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
                        <div class="card card-signin my-5">
                            <div class="card-body">
                                <h5 class="card-title text-center">Create a profile</h5>
                                <form name="username" class="form-signin" th:action="@{/profile/create}" method="POST"
                                      th:object="${profile}">
                                    <div class="form-label-group">
                                        <input type="text" id="city" class="form-control" name="city" placeholder="city"
                                               required autofocus/>
                                        <label class="form-root" for="city">City</label>
                                    </div>
                                    <div class="form-label-group">
                                        <input type="text" id="state" class="form-control" placeholder="state"
                                               name="state"
                                               required/>
                                        <label class="form-root" for="state">State</label>
                                    </div>
                                    <div class="form-group">
                                        <label for="profileType">Profile Type</label>
                                        <select class="form-control" id="profileType" name="profileType">
                                            <option>Band</option>
                                            <option>Musician</option>
                                            <option>Venue</option>
                                            <option>Fan</option>
                                        </select>
                                    </div>
                                    <div class="form-label-group">
                                    <textarea type="text" id="bio" class="form-control" placeholder="bio" name="bio"
                                              th:rows="4" required></textarea>
                                        <label class="form-root" for="bio">Bio</label>
                                    </div>
                                    <div class="form-label-group">
                                        <input type="text" id="interests" class="form-control" placeholder="interests"
                                               name="interests" required/>
                                        <label class="form-root" for="interests">Interest</label>
                                    </div>
                                    <div class="form-label-group">
                                        <input type="text" id="genres" class="form-control" placeholder="genres"
                                               name="genres" required/>
                                        <label class="form-root" for="genres">Genres</label>
                                    </div>
                                    <button class="btn btn-lg btn-primary btn-block text-uppercase" id="btn"
                                            value="Create profile" type="submit">Create profile
                                    </button>
                                    <hr class="my-4">

                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>


    <!--Filestack-->
    <script
            src="https://code.jquery.com/jquery-3.5.1.js"
            integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
            crossorigin="anonymous"></script>
    <script src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>


    <!--Filestack-->
    <script th:inline="javascript">
        const options = {
            onUploadDone:
                function (res) {
                    $("#stashFilestackURL").val(res.filesUploaded[0].url);
                }
        }
        let apiKey = [[${apiKey}]]
        const client = filestack.init(apiKey);

        $("#upload").click(function () {
            client.picker(options).open()
        });
    </script>


    <script>
        const input = document.getElementById("search-input");
        const searchBtn = document.getElementById("search-btn");

        const expand = () => {
            searchBtn.classList.toggle("close");
            input.classList.toggle("square");
        };

        searchBtn.addEventListener("click", expand);

    </script>

<!--Calendar script-->

<script>
    var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    var startYear = 2020;
    var endYear = 2030;
    var month = 0;
    var year = 0;
    var selectedDays = new Array();
    var mousedown = false;
    var mousemove = false;

    function loadCalendarMonths() {
        for (var i = 0; i < months.length; i++) {
            var doc = document.createElement("div");
            doc.innerHTML = months[i];
            doc.classList.add("dropdown-item");

            doc.onclick = (function () {
                var selectedMonth = i;
                return function () {
                    month = selectedMonth;
                    document.getElementById("curMonth").innerHTML = months[month];
                    loadCalendarDays();
                    return month;
                }
            })();

            document.getElementById("months").appendChild(doc);
        }
    }

    function loadCalendarYears() {
        document.getElementById("years").innerHTML = "";

        for (var i = startYear; i <= endYear; i++) {
            var doc = document.createElement("div");
            doc.innerHTML = i;
            doc.classList.add("dropdown-item");

            doc.onclick = (function () {
                var selectedYear = i;
                return function () {
                    year = selectedYear;
                    document.getElementById("curYear").innerHTML = year;
                    loadCalendarDays();
                    return year;
                }
            })();

            document.getElementById("years").appendChild(doc);
        }
    }

    function loadCalendarDays() {
        document.getElementById("calendarDays").innerHTML = "";

        var tmpDate = new Date(year, month, 0);
        var num = daysInMonth(month, year);
        var dayofweek = tmpDate.getDay();       // find where to start calendar day of week

        for (var i = 0; i <= dayofweek; i++) {
            var d = document.createElement("div");
            d.classList.add("day");
            d.classList.add("blank");
            document.getElementById("calendarDays").appendChild(d);
        }

        for (var i = 0; i < num; i++) {
            var todaysDate = new Date().getDate();
            var tmp = i + 1;
            var d = document.createElement("div");
            d.id = "calendarday_" + tmp;
            d.className = "day";
            d.innerHTML = tmp;
            d.dataset.day = tmp;
            //highlights current date
            if (tmp === todaysDate) {
                d.className = "day today";
            }

            d.addEventListener('click', function () {
                this.classList.toggle('selected');

                if (!selectedDays.includes(this.dataset.day))
                    selectedDays.push(this.dataset.day);

                else
                    selectedDays.splice(selectedDays.indexOf(this.dataset.day), 1);
            });

            //event form for calendar to create events
            d.addEventListener('click', function () {
                document.createElement("div");
                d.id = "eventForm";
                d.className = "eventForm";
                d.innerHTML =
                    "<button type=\"button\" class=\"btn btn-primary mt-2\" style='background-color: goldenrod; border: none; margin-left: 38px;' data-toggle=\"modal\" data-target=\"#exampleModal\" data-whatever=\"@mdo\">Add an Event</button>\n" + "<div class=\"modal fade\" id=\"exampleModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n" +
                    "  <div class=\"modal-dialog\">\n" +
                    "    <div class=\"modal-content\">\n" +
                    "      <div class=\"modal-header\">\n" +
                    "        <h5 class=\"modal-title\" id=\"exampleModalLabel\">New Event</h5>\n" +
                    "        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n" +
                    "          <span aria-hidden=\"true\">&times;</span>\n" +
                    "        </button>\n" +
                    "      </div>\n" +
                    "      <div class=\"modal-body\">\n" +
                    "        <form>\n" +
                    "          <div class=\"form-group\">\n" +
                    "            <label for=\"recipient-name\" class=\"col-form-label\">Title:</label>\n" +
                    "            <input type=\"text\" class=\"form-control\" id=\"recipient-name\">\n" +
                    "          </div>\n" +
                    "          <div class=\"form-group\">\n" +
                    "            <label for=\"message-text\" class=\"col-form-label\">Event Description: </label>\n" +
                    "            <textarea class=\"form-control\" id=\"message-text\"></textarea>\n" +
                    "          </div>\n" +
                    "        </form>\n" +
                    "      </div>\n" +
                    "      <div class=\"modal-footer\">\n" +
                    "        <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n" +
                    "        <button type=\"button\" class=\"btn\" style='background-color: goldenrod;'>Create Event</button>\n" +
                    "      </div>\n" +
                    "    </div>\n" +
                    "  </div>\n" +
                    "</div>\n"
            })

            $("#eventForm").click(function(){
                $(".eventForm").toggle();
            })

            d.addEventListener('mousemove', function (e) {
                e.preventDefault();
                if (mousedown) {
                    this.classList.add('selected');

                    if (!selectedDays.includes(this.dataset.day))
                        selectedDays.push(this.dataset.day);
                }
            });

            d.addEventListener('mousedown', function (e) {
                e.preventDefault();
                mousedown = true;
            });

            d.addEventListener('mouseup', function (e) {
                e.preventDefault();
                mousedown = false;
            });

            document.getElementById("calendarDays").appendChild(d);
        }

        var clear = document.createElement("div");
        clear.className = "clear";
        document.getElementById("calendarDays").appendChild(clear);
    }

    function daysInMonth(month, year) {
        var d = new Date(year, month + 1, 0);
        return d.getDate();
    }


    window.addEventListener('load', function () {
        var date = new Date();
        month = date.getMonth();
        year = date.getFullYear();
        document.getElementById("curMonth").innerHTML = months[month];
        document.getElementById("curYear").innerHTML = year;
        loadCalendarMonths();
        loadCalendarYears();
        loadCalendarDays();
    });

</script>


</body>
</html>