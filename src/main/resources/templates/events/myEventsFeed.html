<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head('Events Feed')">
</head>
<body class="main-bg">
<header th:replace="fragments/navbar :: eventsNavbar"></header>
<div class="main-bg">
<div class="container ">
    <div class="row">
        <div class="col-md-3">
<!--            <div class="card">-->
<!--                <ul class="list-group list-group-flush">-->
<!--                    <li class="list-group-item"><a href="#">Notifications</a></li>-->
<!--                    <li class="list-group-item"><a href="#">Messages</a></li>-->
<!--                    <li class="list-group-item"><a href="/feed/posts">Posts</a></li>-->
<!--                    <li class="list-group-item"><a href="/feed/events">Events</a></li>-->
<!--                    <li class="list-group-item"><a th:href="'/my-profile/' + ${profileId}">My Profile</a></li>-->
<!--                </ul>-->
<!--            </div>-->
        </div>
        <div class="sidebar-container">

            <ul class="sidebar-navigation">
                <li class="header"></li>
                <li>
                    <a href="/feed/posts">
                        <i class="fa fa-home" aria-hidden="true"></i>Posts
                    </a>
                </li>
                <li>
                    <a href="/feed/events">
                        <i class="fa fa-tachometer" aria-hidden="true"></i>Events
                    </a>
                </li>
                <li>
                    <a th:href="'/my-profile/' + ${profileId}">
                        <i class="fa fa-users" aria-hidden="true"></i>My Profile
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fa fa-cog" aria-hidden="true"></i> Notifcations
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fa fa-info-circle" aria-hidden="true"></i> Messages
                    </a>
                </li>
            </ul>
        </div>

        <div class="col-md-6">
            <h1>Events</h1>
            <div class="card mb-3">
                <div class="card-body">
                    <a th:href="'/events/create'">Let people know when your next gig, concert, jam session, band practice, or virtual concert online link.</a>
                </div>
            </div>


            <nav class="nav">
                <div>
                    <a class="nav-link" href="/feed/events">Upcoming Events</a>
                    <a class="nav-link" href="/feed/myEvents">My Events</a>
                </div>
            </nav>

            <!-- No Events Found-->
            <div th:if="${noEventsFound}">
                No events were found.
            </div>
            <div class="card mb-2" th:each="event : ${userEvents}">
                <div class="card-body">
                    <h5 th:text="${event.owner.username}"></h5>
                    <p class="card-text" th:text="${event.streetAddress} + ' ' + ${event.city} + ', ' +  ${event.state} + ' ' + ${event.zipcode}"></p>
                    <p class="card-text" th:text="${event.description}"></p>
                    <a th:href="'/events/' + ${event.id} + '/edit'" class="btn btn-primary">Edit Event</a>
                </div>
            </div>
        </div>


        <!--INSERT MAPBOX API HERE-->
        <div class="col-md-3">
            <div class="card mb-3">
                <img src="https://liveatnolan.com/wp-content/uploads/2018/06/Placeholder-Map.jpg" class="card-img-top" alt="...">
                <div class="card-body">
                    <p class="card-text">Map with center view of your city.</p>
                </div>
            </div>



            <!--INSERT CALENDAR HERE-->
            <div class="card mb-3">
<!--                <img src="https://promisedlandcsa.com/wp-content/uploads/2013/05/calendar_placeholder.gif" class="card-img-top" alt="...">-->
                <div class="card-body">
<!--                    <p class="card-text">Your Calendar.</p>-->
                    <div class="calendar" id="calendar">
                        <div class="calendar-btn month-btn" onclick="$('#months').toggle('fast')">
                            <span id="curMonth"></span>
                            <div id="months" class="months dropdown"></div>
                        </div>

                        <div class="calendar-btn year-btn" onclick="$('#years').toggle('fast')">
                            <span id="curYear"></span>
                            <div id="years" class="years dropdown"></div>
                        </div>

                        <div class="clear"></div>

                        <div class="calendar-dates">
                            <div class="days">
                                <div class="day label">S</div>
                                <div class="day label">M</div>
                                <div class="day label">T</div>
                                <div class="day label">W</div>
                                <div class="day label">T</div>
                                <div class="day label">F</div>
                                <div class="day label">S</div>

                                <div class="clear"></div>
                            </div>

                            <div id="calendarDays" class="days">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
</div>
</div>

<!--Calendar Script-->
<script>
    var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    var startYear = 2020;
    var endYear = 2030;
    var month = 0;
    var year = 0;
    var selectedDays = new Array();
    var mousedown = false;
    var mousemove = false;

    function loadCalendarMonths() {
        for (var i = 0; i < months.length; i++) {
            var doc = document.createElement("div");
            doc.innerHTML = months[i];
            doc.classList.add("dropdown-item");

            doc.onclick = (function () {
                var selectedMonth = i;
                return function () {
                    month = selectedMonth;
                    document.getElementById("curMonth").innerHTML = months[month];
                    loadCalendarDays();
                    return month;
                }
            })();

            document.getElementById("months").appendChild(doc);
        }
    }

    function loadCalendarYears() {
        document.getElementById("years").innerHTML = "";

        for (var i = startYear; i <= endYear; i++) {
            var doc = document.createElement("div");
            doc.innerHTML = i;
            doc.classList.add("dropdown-item");

            doc.onclick = (function () {
                var selectedYear = i;
                return function () {
                    year = selectedYear;
                    document.getElementById("curYear").innerHTML = year;
                    loadCalendarDays();
                    return year;
                }
            })();

            document.getElementById("years").appendChild(doc);
        }
    }

    function loadCalendarDays() {
        document.getElementById("calendarDays").innerHTML = "";

        var tmpDate = new Date(year, month, 0);
        var num = daysInMonth(month, year);
        var dayofweek = tmpDate.getDay();       // find where to start calendar day of week

        for (var i = 0; i <= dayofweek; i++) {
            var d = document.createElement("div");
            d.classList.add("day");
            d.classList.add("blank");
            document.getElementById("calendarDays").appendChild(d);
        }

        for (var i = 0; i < num; i++) {
            var todaysDate = new Date().getDate();
            var tmp = i + 1;
            var d = document.createElement("div");
            d.id = "calendarday_" + tmp;
            d.className = "day";
            d.innerHTML = tmp;
            d.dataset.day = tmp;
            //highlights current date
            if (tmp === todaysDate) {
                d.className = "day today";
            }

            d.addEventListener('click', function () {
                this.classList.toggle('selected');

                if (!selectedDays.includes(this.dataset.day))
                    selectedDays.push(this.dataset.day);

                else
                    selectedDays.splice(selectedDays.indexOf(this.dataset.day), 1);
            });

            //event form for calendar to create events
            d.addEventListener('click', function () {
                document.createElement("div");
                d.id = "eventForm";
                d.className = "eventForm";
                d.innerHTML =
                    "<button type=\"button\" class=\"btn btn-primary mt-2\" style='background-color: goldenrod; border: none; margin-left: 38px;' data-toggle=\"modal\" data-target=\"#exampleModal\" data-whatever=\"@mdo\">Add an Event</button>\n" + "<div class=\"modal fade\" id=\"exampleModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n" +
                    "  <div class=\"modal-dialog\">\n" +
                    "    <div class=\"modal-content\">\n" +
                    "      <div class=\"modal-header\">\n" +
                    "        <h5 class=\"modal-title\" id=\"exampleModalLabel\">New Event</h5>\n" +
                    "        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n" +
                    "          <span aria-hidden=\"true\">&times;</span>\n" +
                    "        </button>\n" +
                    "      </div>\n" +
                    "      <div class=\"modal-body\">\n" +
                    "        <form>\n" +
                    "          <div class=\"form-group\">\n" +
                    "            <label for=\"recipient-name\" class=\"col-form-label\">Title:</label>\n" +
                    "            <input type=\"text\" class=\"form-control\" id=\"recipient-name\">\n" +
                    "          </div>\n" +
                    "          <div class=\"form-group\">\n" +
                    "            <label for=\"message-text\" class=\"col-form-label\">Event Description: </label>\n" +
                    "            <textarea class=\"form-control\" id=\"message-text\"></textarea>\n" +
                    "          </div>\n" +
                    "        </form>\n" +
                    "      </div>\n" +
                    "      <div class=\"modal-footer\">\n" +
                    "        <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n" +
                    "        <button type=\"button\" class=\"btn\" style='background-color: goldenrod;'>Create Event</button>\n" +
                    "      </div>\n" +
                    "    </div>\n" +
                    "  </div>\n" +
                    "</div>\n"
            })

            $("#eventForm").click(function(){
                $(".eventForm").toggle();
            })

            d.addEventListener('mousemove', function (e) {
                e.preventDefault();
                if (mousedown) {
                    this.classList.add('selected');

                    if (!selectedDays.includes(this.dataset.day))
                        selectedDays.push(this.dataset.day);
                }
            });

            d.addEventListener('mousedown', function (e) {
                e.preventDefault();
                mousedown = true;
            });

            d.addEventListener('mouseup', function (e) {
                e.preventDefault();
                mousedown = false;
            });

            document.getElementById("calendarDays").appendChild(d);
        }

        var clear = document.createElement("div");
        clear.className = "clear";
        document.getElementById("calendarDays").appendChild(clear);
    }

    function daysInMonth(month, year) {
        var d = new Date(year, month + 1, 0);
        return d.getDate();
    }


    window.addEventListener('load', function () {
        var date = new Date();
        month = date.getMonth();
        year = date.getFullYear();
        document.getElementById("curMonth").innerHTML = months[month];
        document.getElementById("curYear").innerHTML = year;
        loadCalendarMonths();
        loadCalendarYears();
        loadCalendarDays();
    });

</script>


</body>
</html>